<!DOCTYPE html>
<html>
	<head>
		<title>Leaflet.draw vector editing handlers</title>

		<!-- <link rel="stylesheet" href="../../src/jquery/jquery-ui.css" />
		<script src="../../src/jquery/jquery.js"></script>
		<script src="../../src/jquery/jquery-ui.js"></script> -->

		<script src="../../src/leaflet-src.js"></script>
		<link rel="stylesheet" href="libs/leaflet.css" />
		<script src="../../src/leaflet.extension.js"></script>

		<script src="../../src/Leaflet.draw.js"></script>
		<script src="../../src/Leaflet.Draw.Event.js"></script>
		<link rel="stylesheet" href="../../src/leaflet.draw.css" />

		<script src="../../src/Toolbar.js"></script>
		<script src="../../src/Tooltip.js"></script>

		<script src="../../src/ext/GeometryUtil.js"></script>
		<script src="../../src/ext/LatLngUtil.js"></script>
		<script src="../../src/ext/LineUtil.Intersect.js"></script>
		<script src="../../src/ext/Polygon.Intersect.js"></script>
		<script src="../../src/ext/Polyline.Intersect.js"></script>
		<script src="../../src/ext/TouchEvents.js"></script>

		<script src="../../src/draw/DrawToolbar.js"></script>
		<script src="../../src/draw/handler/Draw.Feature.js"></script>
		<script src="../../src/draw/handler/Draw.SimpleShape.js"></script>
		<script src="../../src/draw/handler/Draw.Polyline.js"></script>
		<script src="../../src/draw/handler/Draw.Marker.js"></script>
		<script src="../../src/draw/handler/Draw.Circle.js"></script>
		<script src="../../src/draw/handler/Draw.CircleMarker.js"></script>
		<script src="../../src/draw/handler/Draw.Polygon.js"></script>
		<script src="../../src/draw/handler/Draw.Rectangle.js"></script>
		<script src="../../src/draw/handler/Draw.DuongDay.js"></script>
		<script src="../../src/draw/handler/Draw.ThanhCai.js"></script>
		<script src="../../src/draw/handler/Draw.Role.js"></script>
		<script src="../../src/draw/handler/Draw.MayBienAp.js"></script>
		<script src="../../src/draw/handler/Draw.Label.js"></script>

		<script src="../../src/edit/EditToolbar.js"></script>
		<script src="../../src/edit/handler/EditToolbar.Edit.js"></script>
		<script src="../../src/edit/handler/EditToolbar.Delete.js"></script>

		<script src="../../src/Control.Draw.js"></script>

		<script src="../../src/edit/handler/Edit.Poly.js"></script>
		<script src="../../src/edit/handler/Edit.SimpleShape.js"></script>
		<script src="../../src/edit/handler/Edit.SimpleShapeSnap.js"></script>
		<script src="../../src/edit/handler/Edit.Rectangle.js"></script>
		<script src="../../src/edit/handler/Edit.Marker.js"></script>
		<script src="../../src/edit/handler/Edit.CircleMarker.js"></script>
		<script src="../../src/edit/handler/Edit.Circle.js"></script>
		<script src="../../src/edit/handler/Edit.ThanhCai.js"></script>
		<script src="../../src/edit/handler/Edit.Role.js"></script>
		<script src="../../src/edit/handler/Edit.MayBienAp.js"></script>
		<script src="../../src/edit/handler/Edit.DuongDay.js"></script>
		<script src="../../src/edit/handler/Edit.Label.js"></script>

		<script src="../../src/leaflet.snap.js"></script>
		<script src="../../src/leaflet.geometryutil.js"></script>
		<script src="../../src/leaflet.rotatedMarker.js"></script>

		<style>
			* {
				box-sizing: border-box;
				padding: 0;
				margin: 0;
			}

			html,
			body {
				height: 100%;
				width: 100%;
			}

			#map {
				width: auto;
				height: 100%;
			}

			.leaflet-mouse-label {
				background-color: #fff;
				cursor: text;
			}

			.div-top {
				position: absolute;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				z-index: 1000;
				display: none;
			}

			.form-label {
				position: absolute;
				top: 50%;
				left: 50%;
				margin-top: -75px;
				margin-left: -150px;
				width: 300px;
				height: 150px;
				border: 1px solid black;
				background-color: #fff;
			}
		</style>
	</head>

	<body>
		<div id="map"></div>
		<script>
			var map = new L.Map("map", {
					center: new L.LatLng(0, 0),
					zoom: 18,
					maxZoom: 25,
					minZoom: 10,
				}),
				drawnItems = L.featureGroup().addTo(map),
				snapLayerA = L.featureGroup().addTo(map),
				snapLayerB = L.featureGroup().addTo(map);
			L.control
				.layers(
					{},
					{ DrawLayer: drawnItems },
					{ position: "topright", collapsed: false }
				)
				.addTo(map);
			L.control
				.layers(
					{},
					{ SnapLayerA: snapLayerA },
					{ position: "topright", collapsed: false }
				)
				.addTo(map);
			L.control
				.layers(
					{},
					{ SnapLayerB: snapLayerB },
					{ position: "topright", collapsed: false }
				)
				.addTo(map);
			var drawControl = new L.Control.Draw({
				edit: {
					featureGroup: drawnItems,
					poly: {
						allowIntersection: false,
					},
					edit: {
						selectedPathOptions: {
							dashArray: "10, 10",
							fill: false,
							fillColor: "#fe57a1",
							fillOpacity: 0.1,
							// Whether to user the existing layers color
							maintainColor: false,
						},
					},
					remove: true,
				},
				draw: {
					polyline: false,
				},
			});

			drawControl.setDrawingOptions({
				label: {
					guideLayers: [snapLayerA, snapLayerB],
					snapDistance: 10,
					repeatMode: true,
				},
				duongDay: {
					guideLayers: [snapLayerA, snapLayerB],
					snapDistance: 10,
					weight: 5,
					lineCap: "square",
					lineJoin: "square",
					color: "red",
				},
				role: {
					guideLayers: [snapLayerA, snapLayerB],
					snapDistance: 10,
					gocXoay: 0,
					weight: 9,
					lineCap: "square",
					lineJoin: "square",
					repeatMode: true,
				},
				thanhCai: {
					guideLayers: [snapLayerA, snapLayerB],
					snapDistance: 10,
					gocXoay: 0,
					weight: 9,
					lineCap: "square",
					repeatMode: true,
				},
				mayBienAp: {
					guideLayers: [snapLayerA, snapLayerB],
					snapDistance: 10,
					gocXoay: 0,
					weight: 9,
					lineCap: "square",
					repeatMode: true,
				},
			});

			map.addControl(drawControl);

			map.on(L.Draw.Event.CREATED, function (event) {
				var layer = event.layer;
				drawnItems.addLayer(layer);
			});

			map.on(L.Draw.Event.EDITED, function (e) {
				e.layers.eachLayer(function (ele) {
					const layer = ele;
					if (
						!(layer instanceof L.DuongDay) &&
						!(layer instanceof L.ThanhCai) &&
						!(layer instanceof L.Marker) &&
						!(layer instanceof L.Rectangle)
					) {
						const layerSnap = layer.getLayerSnap();
						snapLayerB.addLayer(layerSnap);
						snapLayerB.removeLayer(layer.snapLayerId);
						layer.snapLayerId = L.Util.stamp(layerSnap);
					}
				});
			});

			map.on(L.Draw.Event.DELETED, function (e) {
				e.layers.eachLayer(function (ele) {
					const layer = ele;
					if (
						!(layer instanceof L.DuongDay) &&
						!(layer instanceof L.ThanhCai) &&
						!(layer instanceof L.Marker) &&
						!(layer instanceof L.Rectangle)
					) {
						snapLayerB.removeLayer(layer.snapLayerId);
					}
				});
			});

			drawnItems.on("layeradd", function (e) {
				const layer = e.layer;
				if (
					!(layer instanceof L.DuongDay) &&
					!(layer instanceof L.ThanhCai) &&
					!(layer instanceof L.Marker) &&
					!(layer instanceof L.Rectangle)
				) {
					const layerSnap = layer.getLayerSnap();
					snapLayerB.addLayer(layerSnap);
					layer.snapLayerId = L.Util.stamp(layerSnap);
				}
			});

			map.on(L.Draw.Event.STARTDRAWLABEL, function () {
				var options = {
					text: "C#",
					fontSize: 14,
					fontFamily: "Times New Roman",
					fontColor: "red",
					isBold: false,
					isItalic: false,
				};
				map.fire(L.Draw.Event.FINISHDRAWLABEL, options);
			});

			map.on(L.Draw.Event.STARTEDITLABEL, function (marker) {
				var options = {
					text: "C# FIX",
					fontSize: 14,
					fontFamily: "Times New Roman",
					fontColor: "red",
					isBold: false,
					isItalic: false,
				};
				map.fire(L.Draw.Event.FINISHEDITLABEL, {
					marker: marker,
					options: options,
				});
			});
		</script>
	</body>
</html>
